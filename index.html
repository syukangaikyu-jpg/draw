<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>週刊鎧球 WEEK50 抽選</title>
</head>
<body style="font-family:sans-serif; text-align:center; padding:50px;">
  <h1>WEEK50<br>記念抽選</h1>
  <p>「抽選する」を押すと当落が出ます。<br>当たりは5名限定！</p>
  <button onclick="draw()">抽選する</button>
  <div id="result" style="margin-top:20px; font-size:18px;"></div>

<script>
  // ここにあとでGoogle Apps ScriptのURLを入れます
  const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbzATnE64sDfTqsZruBA1RoDFh3fRzogZaozg5juIlrfApDOH_55_zn3kJX6YyAx63M8Sw/exec";
const KEY = "sg_week50_draw_done"; // この端末で抽選したかどうか記録するキー

async function draw() {
  // すでに抽選済みなら再挑戦不可
  if (localStorage.getItem(KEY)) {
    document.getElementById("result").innerHTML =
      "⚠️ この端末では抽選は1回までです。";
    return;
  }

  try {
    let res = await fetch(WEB_APP_URL);
    let data = await res.json();

    if (data.result === "win") {
      document.getElementById("result").innerHTML =
        "🎉 当選！こちらから住所を入力してください 👉 " +
        "<a href='https://docs.google.com/forms/d/https://forms.gle/i2LQe7MFNzf55JfV9/viewform' target='_blank'>当選者フォーム</a>";
      localStorage.setItem(KEY, "win"); // 抽選済みフラグを保存
    } else {
      document.getElementById("result").innerHTML = "😢 ハズレ…また挑戦してね！";
      localStorage.setItem(KEY, "lose"); // 抽選済みフラグを保存
    }
  } catch (e) {
    document.getElementById("result").innerHTML = "通信エラー：設定を確認してください。";
  }
}
</script>
</body>
</html>
